{% extends 'geral/base.html' %}
{% block titulo %} {{ psicologo.nome_completo }} {% endblock %}

{% load static %}

{% block conteudo %}
    <div class="row gap-4 flex-nowrap profile">
        <main class="col d-flex flex-column gap-5 profile__main">
            <header class="hstack gap-4 profile__header">
                <img
                        class="rounded-circle mx-auto profile__avatar"
                        src="{{ psicologo.get_url_foto_propria_ou_padrao }}"
                        alt="Foto de perfil do psicólogo"
                />

                <div class="flex-grow-1">
                    <h3 class="fw-bold">{{ psicologo.nome_completo }}</h3>
                    <hr class="border border-primary opacity-100"/>
                    <div class="hstack gap-5 profile__stats">
                        <div class="profile__stat">
                            <h6 class="text-body-secondary">Valor da consulta</h6>
                            <h6 class="fw-semibold">R${{ psicologo.valor_consulta|default:"0"|floatformat:"2" }}</h6>
                        </div>
                        <div class="profile__stat">
                            <h6 class="text-body-secondary">CRP</h6>
                            <h6 class="fw-semibold">{{ psicologo.crp }}</h6>
                        </div>
                    </div>
                </div>
            </header>

            <section class="vstack gap-2">
                <h6>Especializações</h6>
                <div class="hstack gap-2 flex-wrap">
                    {% include "geral/especializacoes.html" %}
                </div>
            </section>

            <section class="vstack gap-2">
                <h6>Sobre mim</h6>
                <div class="text-body-secondary">
                    {{ psicologo.sobre_mim|default:"<i>Este psicólogo ainda não definiu seu Sobre Mim.</i>" }}
                </div>
            </section>

            <section class="vstack gap-2">
                <h6>Disponibilidade</h6>
                {% if psicologo.disponibilidade %}
                    {% include 'geral/tabela_disponibilidade.html' with matriz_disponibilidade_booleanos_em_json=psicologo.get_matriz_disponibilidade_booleanos_em_json %}
                {% else %}
                    <div class="text-body-secondary"><i>Este psicólogo ainda não definiu sua disponibilidade.</i></div>
                {% endif %}
            </section>
        </main>

        <aside class="col-auto rounded-3 booking-sidebar">
            <div class="vstack gap-3 sticky-top" id="agendamentoConsulta">
                <form method="post" class="booking">
                    {% csrf_token %}
                    <fieldset class="vstack gap-3" {% if not request.user.is_paciente %} disabled {% endif %}>
                        {{ form.non_field_errors }}

                        <h6 class="text-center booking__title">Agende sua consulta</h6>

                        <input id="calendario" type="text" class="d-none" aria-label="Calendário de seleção de datas"/>

                        <div id="lista-slots" class="vstack gap-2" aria-live="polite"></div>

                        <div class="d-flex justify-content-between align-items-center total-row">
                            <span id="total-descricao" class="total-row__label">Total</span>
                            <span id="total-valor" class="total-row__value fw-semibold">R$0,00</span>
                        </div>
                        <input type="hidden" name="agendamentos" id="id_agendamentos" value="[]"/>

                        <button id="btn-confirmar" class="btn btn-success btn-lg w-100" type="submit" disabled>
                            Confirmar consultas
                        </button>

                        {% if request.user.is_anonymous %}
                            <div class="text-body-secondary">
                                Você precisa estar logado para agendar uma consulta.
                            </div>
                        {% elif not request.user.is_paciente %}
                            <div class="text-body-secondary">
                                Sua conta não é de paciente para poder agendar uma consulta.
                            </div>
                        {% endif %}
                    </fieldset>
                </form>
            </div>
        </aside>
    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"/>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Karla:wght@400;600;700&family=Livvic:wght@400;600;700&display=swap"
          rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/perfil.css' %}"/>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js" defer></script>
    <script src="{% static 'js/perfil.js' %}" defer></script>
{% endblock %}

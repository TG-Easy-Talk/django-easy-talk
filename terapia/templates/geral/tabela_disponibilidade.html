<div class="text-end mb-2">
    <small>Semana: {{ week_offset }}</small>
</div>

<div class="table-responsive rounded-3 border border-primary">
    <table class="table table-borderless text-center mb-0 text-nowrap">
        <colgroup>
            <col style="width: 14.2857%;">
            <col style="width: 14.2857%;">
            <col style="width: 14.2857%;">
            <col style="width: 14.2857%;">
            <col style="width: 14.2857%;">
            <col style="width: 14.2857%;">
            <col style="width: 14.2857%;">
        </colgroup>
        <thead class="table-primary">
        <tr>
            <th class="text-white" scope="col">Domingo</th>
            <th class="text-white" scope="col">Segunda</th>
            <th class="text-white" scope="col">Terça</th>
            <th class="text-white" scope="col">Quarta</th>
            <th class="text-white" scope="col">Quinta</th>
            <th class="text-white" scope="col">Sexta</th>
            <th class="text-white" scope="col">Sábado</th>
        </tr>
        </thead>
        <tbody id="tbodyDisponibilidade">
        </tbody>
    </table>
</div>

<script>
    class DisponibilidadeTabela {
        static matriz_disponibilidade_booleanos = {{ matriz_disponibilidade_booleanos|safe }};
        static tbody = document.getElementById('tbodyDisponibilidade');

        static atualizar() {
            const m = this.matriz_disponibilidade_booleanos;
            if (!m.some(row => row.includes(true))) {
                this.tbody.innerHTML = '<tr>' + '<td>-</td>'.repeat(7) + '</tr>';
                return;
            }
            let maxInt = 0;
            const diasInt = m.map(row => {
                const ints = [];
                for (let i = 0; i < 24;) {
                    if (row[i]) {
                        const start = i;
                        while (i < 24 && row[i]) i++;
                        ints.push(
                            `${start.toString().padStart(2, '0')}:00 – ${i.toString().padStart(2, '0')}:00`
                        );
                    } else i++;
                }
                maxInt = Math.max(maxInt, ints.length);
                return ints;
            });

            diasInt.forEach(ints => {
                while (ints.length < maxInt) ints.push('-');
            });

            const rows = [];
            for (let r = 0; r < maxInt; r++) {
                let tr = '<tr>';
                for (let d = 0; d < 7; d++) {
                    tr += `<td>${diasInt[d][r]}</td>`;
                }
                tr += '</tr>';
                rows.push(tr);
            }
            this.tbody.innerHTML = rows.join('');
        }
    }

    DisponibilidadeTabela.atualizar();
</script>
